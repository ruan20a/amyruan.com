/*!CK:4107021395!*//*1390791171,178186553*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ugiRk"]); }

__d("AsyncDOM",["CSS","DOM"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i={invoke:function(j,k){for(var l=0;l<j.length;++l){var m=j[l],n=m[0],o=m[1],p=m[2],q=m[3],r=(p&&k)||null;if(o)r=h.scry(r||document.documentElement,o)[0];switch(n){case 'eval':(new Function(q)).apply(r);break;case 'hide':g.hide(r);break;case 'show':g.show(r);break;case 'setContent':h.setContent(r,q);break;case 'appendContent':h.appendContent(r,q);break;case 'prependContent':h.prependContent(r,q);break;case 'insertAfter':h.insertAfter(r,q);break;case 'insertBefore':h.insertBefore(r,q);break;case 'remove':h.remove(r);break;case 'replace':h.replace(r,q);break;default:}}}};e.exports=i;});
__d("MorePagerFetchOnScroll",["AsyncRequest","DOMQuery","Event","Style","Vector","throttle"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('DOMQuery'),i=b('Event'),j=b('Style'),k=b('Vector'),l=b('throttle');function m(n,o){"use strict";this._pager=n;this._offset=o||0;this._scrollParent=j.getScrollParent(n);this.setPagerInViewHandler(this._defaultPagerInViewHandler.bind(this));if(!this.check())this._scrollListener=i.listen(this._scrollParent,'scroll',l(function(){this.check();}.bind(this),50));}m.prototype.check=function(){"use strict";if(!h.contains(document.body,this._pager)){this.removeScrollListener();return true;}var n=k.getElementPosition(this._pager).y,o=this._scrollParent===window?k.getViewportDimensions().y:k.getElementDimensions(this._scrollParent).y,p=this._scrollParent===window?k.getScrollPosition().y+o:k.getElementPosition(this._scrollParent).y+o;if(n-this._offset<p){this._inViewHandler();this.removeScrollListener();return true;}return false;};m.prototype.removeScrollListener=function(){"use strict";this._scrollListener&&this._scrollListener.remove();};m.prototype.setPagerInViewHandler=function(n){"use strict";this._inViewHandler=n;return this;};m.prototype._defaultPagerInViewHandler=function(){"use strict";var n=h.scry(this._pager,'a')[0];if(n)g.bootstrap(n.getAttribute('ajaxify')||n.href,n);};e.exports=m;});
__d("PluginLikebox",["AsyncDOM","AsyncRequest","CSS","DOMEvent","DOMEventListener","DOMQuery","MorePagerFetchOnScroll","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncDOM'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOMEvent'),k=b('DOMEventListener'),l=b('DOMQuery'),m=b('MorePagerFetchOnScroll'),n=b('copyProperties');function o(p,q){this.stream_id=p;this.force_wall=q;this.load();k.add(l.find(document.body,'.pluginLikeboxStream'),'click',function(r){var s=new j(r),t=s.target.parentNode;if(i.hasClass(t,'text_exposed_link')){s.kill();i.addClass(l.find(t,'^.text_exposed_root'),'text_exposed');}});}n(o.prototype,{load:function(p){new h().setMethod('GET').setURI('/plugins/likebox/stream').setData({id:this.stream_id,dom:p?'pluginLikeboxMoreStories':'pluginLikeboxStream',force_wall:this.force_wall,nobootload:1,inlinecss:1,max_timestamp:p}).setReadOnly(true).setErrorHandler(function(){}).setHandler(this.handleResponse.bind(this)).send();},handleResponse:function(p){if(p.inlinecss){var q=document.createElement('style');q.setAttribute("type","text/css");document.getElementsByTagName('head')[0].appendChild(q);if(q.styleSheet){q.styleSheet.cssText=p.inlinecss;}else q.appendChild(document.createTextNode(p.inlinecss));}g.invoke(p.domops);var r=l.scry(document.body,"#pluginLikeboxMoreStories a");if(!r.length)return;r=r[0];var s=function(){this.load(parseInt(r.getAttribute('data-timestamp'),10));var t=l.find(r.parentNode,'.uiMorePagerLoader');i.addClass(t,'uiMorePagerPrimary');i.removeClass(t,'uiMorePagerLoader');i.hide(r);}.bind(this);k.add(r,'click',function(t){new j(t).kill();s();});new m(r,0).setPagerInViewHandler(s);}});e.exports=o;});